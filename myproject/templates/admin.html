{% extends "base_admin.html" %}
{% block title %}Login Page{% endblock %}

{% block content %}
<form action="/admin" method="post">
    <p>Username:</p>
    <p><input type="text" name="username" /></p>
    <p>Password:</p>
    <p><input type="password" name="password" /></p>
    <p><input type="submit" value="Submit"/></p>
</form>
{% endblock %}

  
@app.route("/profile")
def profile():
    if "user_id" not in session:
        return redirect("/login")
    
    user_id = session["user_id"]
    user_profile = Profile.query.filter_by(id=user_id).first()
    
    return render_template("profile.html", profile=user_profile)

@app.route("/edit_profile", methods=['GET', 'POST'])
def edit_profile():
    if "user_id" not in session:
        return redirect("/login")
    
    # Retrieve the user's profile based on the user_id from the session
    user_id = session["user_id"]
    user_profile = Profile.query.filter_by(user_id=user_id).first()

    if request.method == 'POST':
        # Update the user's profile based on the form data
        full_name = request.form.get("full_name")
        date_of_birth = request.form.get("date_of_birth")
        education = request.form.get("education")
        institution = request.form.get("institution")

        if not user_profile:
            new_profile = Profile(user_id=user_id, full_name=full_name, date_of_birth=date_of_birth,
                                  education=education, institution=institution)
            try:
                db.session.add(new_profile)
                db.session.commit()
                return redirect("/profile")
            except Exception as e:
                db.session.rollback()
                return f"Error: {str(e)}"

        # Update the existing user's profile
        if user_profile:
            user_profile.full_name = full_name
            user_profile.date_of_birth = date_of_birth
            user_profile.education = education
            user_profile.institution = institution

            try:
                db.session.commit()
                return redirect("/profile")
            except Exception as e:
                db.session.rollback()
                return f"Error: {str(e)}"

        return redirect("/profile")

    return render_template("edit_profile.html", profile=user_profile)

